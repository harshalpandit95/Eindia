(function(c){function a(){this.isField=true,this.down=false,this.inFocus=false,this.cutOff=false,this.hasLabel=false,this.keyboardMode=false,this.nativeTouch=true,this.wrapperClass="dropdown",this.onSelect=null}a.prototype={constructor:a,instances:[],init:function(f,e){var d=this;c.extend(d,e);d.$select=c(f);d.options=[];d.$options=d.$select.find("option");d.isTouch="ontouchend" in document;d.$select.removeClass(d.wrapperClass+" dropdown");if(d.$options.length){d.$options.each(function(g){var h=c(this);if(h.is(":selected")){d.selected={index:g,title:h.text()};d.focusIndex=g}if(h.hasClass("label")&&g==0){d.hasLabel=true;d.label=h.text();h.attr("value","")}else{d.options.push({domNode:h[0],title:h.text(),value:h.val(),selected:h.is(":selected")})}});if(!d.selected){d.selected={index:0,title:d.$options.eq(0).text()};d.focusIndex=0}d.render()}},render:function(){var f=this,d=f.isTouch&&f.nativeTouch?" touch":"";f.$container=f.$select.wrap('<div class="'+f.wrapperClass+d+'"><span class="old"/></div>').parent().parent();f.$active=c('<span class="selected">'+f.selected.title+"</span>").appendTo(f.$container);f.$carat=c('<span class="carat"/>').appendTo(f.$container);f.$scrollWrapper=c("<div><ul/></div>").appendTo(f.$container);f.$dropDown=f.$scrollWrapper.find("ul");f.$form=f.$container.closest("form");c.each(f.options,function(){var g=this,h=g.selected?' class="active"':"";f.$dropDown.append("<li"+h+">"+g.title+"</li>")});f.$items=f.$dropDown.find("li");f.maxHeight=0;if(f.cutOff&&f.$items.length>f.cutOff){f.$container.addClass("scrollable")}for(i=0;i<f.$items.length;i++){var e=f.$items.eq(i);f.maxHeight+=e.outerHeight();if(f.cutOff==i+1){break}}if(f.isTouch&&f.nativeTouch){f.bindTouchHandlers()}else{f.bindHandlers()}},bindTouchHandlers:function(){var d=this;d.$container.on("click",function(){d.$select.focus()});d.$select.on({change:function(){var e=c(this).find("option:selected"),g=e.text(),f=e.val();d.$active.text(g);if(typeof d.onSelect=="function"){d.onSelect.call(d,{title:g,value:f})}},focus:function(){d.$container.addClass("focus")},blur:function(){d.$container.removeClass("focus")}})},bindHandlers:function(){var d=this;d.query="";d.$container.on({click:function(){if(!d.down){d.open()}else{d.close()}},mousemove:function(){if(d.keyboardMode){d.keyboardMode=false}}});c("body").on("click",function(g){var f=c(g.target),h=d.wrapperClass.split(" ").join(".");if(!f.closest("."+h).length&&d.down){d.close()}});d.$items.on({click:function(){var e=c(this).index();d.select(e)},mouseover:function(){if(!d.keyboardMode){var e=c(this);e.addClass("focus").siblings().removeClass("focus");d.focusIndex=e.index()}},mouseout:function(){if(!d.keyboardMode){c(this).removeClass("focus")}}});d.$select.on({focus:function(){d.$container.addClass("focus");d.inFocus=true},blur:function(){d.$container.removeClass("focus");d.inFocus=false}});d.$dropDown.on("scroll",function(f){if(d.$dropDown[0].scrollTop==d.$dropDown[0].scrollHeight-d.maxHeight){d.$container.addClass("bottom")}else{d.$container.removeClass("bottom")}});d.$select.on("keydown",function(k){if(d.inFocus){d.keyboardMode=true;var g=k.keyCode;if(g==38||g==40||g==32){k.preventDefault();if(g==38){d.focusIndex--;d.focusIndex=d.focusIndex<0?d.$items.length-1:d.focusIndex}else{if(g==40){d.focusIndex++;d.focusIndex=d.focusIndex>d.$items.length-1?0:d.focusIndex}}if(!d.down){d.open()}d.$items.removeClass("focus").eq(d.focusIndex).addClass("focus");if(d.cutOff){var j=d.$items.eq(d.focusIndex),f=(j.outerHeight()*(d.focusIndex+1))-d.maxHeight;d.$dropDown.scrollTop(f)}d.query=""}if(d.down){if(g==9||g==27){d.close()}else{if(g==13){k.preventDefault();d.select(d.focusIndex);d.close();return false}else{if(g==8){k.preventDefault();d.query=d.query.slice(0,-1);d.search();return false}else{if(g!=38&&g!=40){var h=String.fromCharCode(g);d.query+=h;d.search()}}}}}}});if(d.$form.length){d.$form.on("reset",function(){var e=d.hasLabel?d.label:"";d.$active.text(e)})}},open:function(){var d=this,f=window.scrollY||document.documentElement.scrollTop,g=window.scrollX||document.documentElement.scrollLeft,e=d.notInViewport(f);d.closeAll();d.$select.focus();window.scrollTo(g,f+e);d.$container.addClass("open");d.$scrollWrapper.css("height",d.maxHeight+"px");d.down=true},close:function(){var d=this;d.$container.removeClass("open");d.$scrollWrapper.css("height","0px");d.focusIndex=d.selected.index;d.query="";d.down=false},closeAll:function(){var d=this,e=Object.getPrototypeOf(d).instances;for(i=0;i<e.length;i++){e[i].close()}},select:function(f){var e=this,g=e.options[f],d=e.hasLabel?f+1:f;e.$items.removeClass("active").eq(f).addClass("active");e.$active.text(g.title);e.$select.find("option").prop("selected",false).eq(d).prop("selected","selected");e.selected={index:f,title:g.title};e.focusIndex=i;if(typeof e.onSelect=="function"){e.onSelect.call(e,{title:g.title,value:g.value})}},search:function(){var d=this;for(i=0;i<d.options.length;i++){var e=d.options[i].title.toUpperCase();if(e.indexOf(d.query)!=-1){d.focusIndex=i;d.$items.removeClass("focus").eq(d.focusIndex).addClass("focus");break}}},notInViewport:function(g){var f=this,e={min:g,max:g+(window.innerHeight||document.documentElement.clientHeight)},d=f.$dropDown.offset().top+f.maxHeight;if(d>=e.min&&d<=e.max){return 0}else{return(d-e.max)+5}}};function b(f,e){var d=new a();d.init(f,e);d.instances.push(d)}c.fn.easyDropDown=function(d){return this.each(function(){b(this,d)})};c(function(){if(typeof Object.getPrototypeOf!=="function"){if(typeof"test".__proto__==="object"){Object.getPrototypeOf=function(d){return d.__proto__}}else{Object.getPrototypeOf=function(d){return d.constructor.prototype}}}c(".dropdown").each(function(){var d=c(this).attr("data-settings");settings=d?c.parseJSON(d):{};b(this,settings)})})})(jQuery);